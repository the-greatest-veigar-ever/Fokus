{% extends "base.html" %}

{% block title %}Focus Session - FocusFlow{% endblock %}

{% block extra_head %}
<style>
    body { margin: 0; overflow: hidden; }
    .navbar { display: none; }
</style>
{% endblock %}

{% block content %}
<div class="focus-container" id="focusContainer">
    <!-- Background will be set dynamically -->

    <!-- Top Controls -->
    <div class="focus-header">
        <button id="exitFocus" class="exit-btn">
            <span class="icon icon-arrow-left icon-sm"></span>
            Exit Focus Mode
        </button>
        <div class="session-info">
            <span id="sessionType">Focus Session</span>
        </div>
        <button id="settingsBtn" class="settings-btn">
            <span class="icon icon-settings icon-sm"></span>
        </button>
    </div>

    <!-- Main Timer Display -->
    <div class="timer-display">
        {% include 'components/timer.html' %}
    </div>

    <!-- Bottom Controls -->
    <div class="focus-footer">
        <!-- Audio Controls -->
        <div class="audio-section">
            {% include 'components/audio_controls.html' %}
        </div>

        <!-- Environment Controls -->
        <div class="environment-section">
            <div class="control-group">
                <label>Background</label>
                <select id="backgroundSelect" class="control-select">
                    <option value="">Choose background...</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Settings Panel (Hidden by default) -->
    <div id="settingsPanel" class="settings-panel hidden">
        <div class="settings-content">
            <h3>Session Settings</h3>

            <div class="setting-group">
                <label for="timerDuration">Focus Duration (minutes)</label>
                <input type="number" id="timerDuration" value="25" min="1" max="120">
            </div>

            <div class="setting-group">
                <label for="breakDuration">Break Duration (minutes)</label>
                <input type="number" id="breakDuration" value="5" min="1" max="30">
            </div>

            <div class="setting-group">
                <label for="sessionType">Session Type</label>
                <select id="sessionTypeSelect">
                    <option value="focus">Focus</option>
                    <option value="break">Break</option>
                    <option value="custom">Custom</option>
                </select>
            </div>

            <div class="setting-actions">
                <button id="applySettings" class="btn btn-primary">Apply</button>
                <button id="closeSettings" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Session Complete Modal -->
    <div id="sessionComplete" class="modal hidden">
        <div class="modal-content">
            <div class="modal-icon">
                <span class="icon icon-check icon-xl"></span>
            </div>
            <h2>Session Complete!</h2>
            <p id="sessionSummary"></p>

            <div class="modal-actions">
                <button id="startBreak" class="btn btn-secondary">Take a Break</button>
                <button id="startAnother" class="btn btn-primary">Start Another</button>
                <button id="finishSession" class="btn btn-outline">Finish</button>
            </div>
        </div>
    </div>
</div>

<!-- Audio elements will be added dynamically -->
<div id="audioContainer"></div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/timer.js') }}"></script>
<script src="{{ url_for('static', filename='js/audio.js') }}"></script>
<script>
    // Initialize focus session
    document.addEventListener('DOMContentLoaded', function() {
        initializeFocusMode();
    });
</script>
{% endblock %}